!function(t){"use strict";function i(t){this.config={pluginClass:"wok-",pluginPrefix:"wok-"};for(var i in t)this.config[i]=t[i];this.pipes={},this.plugins={},this.debug=!1}i.prototype.use=function(t,e){var n=t;if(e||(e=i.plugins[t]),"string"==typeof e&&(n=e,e=this.plugins[e]),!e)throw new Error("Plugin "+n+" not known to Wok.");this.plugins[t]=e},i.prototype.init=function(t){for(var i in this.plugins)for(var e=this.plugins[i],n=t.querySelectorAll("[data-"+this.config.pluginPrefix+i+"]"),r=0;r<n.length;r++)this._initPlugin(e,i,n[r])},i.prototype._initPlugin=function(i,e,n){var r,s=(n.getAttribute("data-"+this.config.pluginPrefix+e)||"").trim().split("/"),o=s.shift(),u=s.shift(),p={};o&&(p.input=[o,function(){return r.render.apply(this,arguments)}],p.input[1].displayName=e+"/"+o+"/input",p.inputName=o),u&&(p.output=[u,function(){return r.request.apply(this,arguments)}],p.output[1].displayName=e+"/"+u+"/output",p.outputName=u),p=this.register(p);var a=t.parse("["+s.join("/")+"]");if(a.unshift(n),r=i.apply(p,a),!r)throw new Error("Wok plugin "+e+" did not return controls");var l,g;if(r.request===!0&&(l=!0,delete r.request),r.render===!0&&(g=!0,delete r.render),o&&!("render"in r))throw new Error("Wok plugin “"+e+"” not meant to be used with input pipes");if(u&&!("request"in r))throw new Error("Wok plugin “"+e+"” not meant to be used with output pipes");l&&p.request(),g&&p.render(),null!==this.config.pluginClass&&(n.className+=" "+this.config.pluginClass+e)},i.prototype._getPipe=function(t){return t in this.pipes||(this.pipes[t]={source:null,destinations:[]}),this.pipes[t]},i.prototype._getStage=function(t,i){var e={};return t&&(e.request=this.request.bind(this,t)),i&&(e.render=this.render.bind(this,i)),e.wok=this,e},i.prototype.register=function(t){var i,e;return"input"in t&&(i=t.input[0],this.subscribe(i,t.input[1])),"output"in t&&(e=t.output[0],this.provide(e,t.output[1])),this._getStage(i,e)},i.prototype.provide=function(t,i,e){var n=this._getPipe(t);if(n.source&&!e)throw new Error("Cannot replace defined pipe “"+t+"”’s source");n.source=i},i.prototype.subscribe=function(t,i){var e=this._getPipe(t);e.destinations.push(i)},i.prototype.render=function(t){var i=this._getPipe(t),e=Array.prototype.slice.call(arguments,1);this.debug&&console.debug("Wok rendering "+t,e,i.destinations);for(var n=0;n<i.destinations.length;n++)i.destinations[n].apply(this,e)},i.prototype.request=function(t){var i=this._getPipe(t),e=Array.prototype.slice.call(arguments,1);return this.debug&&console.debug("Wok requesting "+t,e,i.source),i.source.apply(this,e)},i.plugins={},window.Wok=i}(window.JSON);
//# sourceMappingURL=Wok.min.js.map