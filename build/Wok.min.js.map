{"version":3,"sources":["Wok.js"],"names":["JSON","Wok","config","this","pluginClass","pluginPrefix","key","pipes","plugins","debug","prototype","use","name","plugin","init","element","elements","querySelectorAll","i","length","_initPlugin","pluginControls","attr","getAttribute","trim","split","input","shift","output","stage","render","apply","arguments","displayName","inputName","request","outputName","register","args","parse","join","unshift","Error","requestImmediately","renderImmediately","className","_getPipe","pipeName","source","destinations","_getStage","inputPipeName","outputPipeName","result","bind","wok","subscribe","provide","replace","destination","push","Array","slice","call","console","window"],"mappings":"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","file":"Wok.min.js","sourcesContent":["(function(JSON) {\n\t'use strict';\n\n\tfunction Wok(config) {\n\t\tthis.config = {\n\t\t\tpluginClass: 'wok-',\n\t\t\tpluginPrefix: 'wok-'\n\t\t};\n\t\tfor(var key in config) {\n\t\t\tthis.config[key] = config[key];\n\t\t}\n\n\t\tthis.pipes = {};\n\n\t\tthis.plugins = {};\n\n\t\tthis.debug = false;\n\t}\n\n\tWok.prototype.use = function(name, plugin) {\n\t\tthis.plugins[name] = plugin;\n\t};\n\t\n\tWok.prototype.init = function(element) {\n\t\tfor(var name in this.plugins) {\n\t\t\tvar plugin = this.plugins[name];\n\t\t\tvar elements = element.querySelectorAll('[data-'+this.config.pluginPrefix+name+']');\n\t\t\tfor(var i=0;i<elements.length;i++) {\n\t\t\t\tthis._initPlugin(plugin, name, elements[i]);\n\t\t\t}\n\t\t}\n\t};\n\n\tWok.prototype._initPlugin = function(plugin, name, element) {\n\t\t// jshint maxstatements: false\n\t\tvar attr = (element.getAttribute('data-'+this.config.pluginPrefix+name)||'').trim().split('/');\n\t\tvar input = attr.shift();\n\t\tvar output = attr.shift();\n\n\t\tvar pluginControls;\n\t\tvar stage = {};\n\t\tif(input) {\n\t\t\tstage.input = [input, function() {\n\t\t\t\treturn pluginControls.render.apply(this, arguments);\n\t\t\t}];\n\t\t\t// Set the input function’s display name to make debugging easier\n\t\t\tstage.input[1].displayName = name+'/'+input+'/input';\n\t\t\tstage.inputName = input;\n\t\t}\n\t\tif(output) {\n\t\t\tstage.output = [output, function() {\n\t\t\t\treturn pluginControls.request.apply(this, arguments);\n\t\t\t}];\n\t\t\t// Set the output function’s display name to make debugging easier\n\t\t\tstage.output[1].displayName = name+'/'+output+'/output';\n\t\t\tstage.outputName = output;\n\t\t}\n\n\t\tstage = this.register(stage);\n\t\tvar args = JSON.parse('['+attr.join('/')+']');\n\t\targs.unshift(element);\n\t\tpluginControls = plugin.apply(stage, args);\n\n\t\tif(!pluginControls) {\n\t\t\tthrow new Error('Wok plugin '+name+' did not return controls');\n\t\t}\n\n\t\tvar requestImmediately, renderImmediately;\n\t\tif(pluginControls.request === true) {\n\t\t\trequestImmediately = true;\n\t\t\tdelete pluginControls.request;\n\t\t}\n\t\tif(pluginControls.render === true) {\n\t\t\trenderImmediately = true;\n\t\t\tdelete pluginControls.render;\n\t\t}\n\n\t\t// Sanity-check pluginControls\n\t\tif(input && !('render' in pluginControls)) {\n\t\t\tthrow new Error('Wok plugin “'+name+'” not meant to be used with input pipes');\n\t\t}\n\t\tif(output && !('request' in pluginControls)) {\n\t\t\tthrow new Error('Wok plugin “'+name+'” not meant to be used with output pipes');\n\t\t}\n\n\t\tif(requestImmediately) {\n\t\t\tstage.request();\n\t\t}\n\t\tif(renderImmediately) {\n\t\t\tstage.render();\n\t\t}\n\n\t\tif(this.config.pluginClass !== null) {\n\t\t\telement.className += ' '+this.config.pluginClass+name;\n\t\t}\n\t};\n\t\n\t/**\n\t * Returns the complete defintion of a pipe\n\t */\n\tWok.prototype._getPipe = function(pipeName) {\n\t\tif(!(pipeName in this.pipes)) {\n\t\t\tthis.pipes[pipeName] = {\n\t\t\t\tsource: null,\n\t\t\t\tdestinations: []\n\t\t\t};\n\t\t}\n\t\treturn this.pipes[pipeName];\n\t};\n\n\t/**\n\t * Returns the complete defintion of a stage.\n\t */\n\tWok.prototype._getStage = function(inputPipeName, outputPipeName) {\n\t\tvar result = {};\n\t\tif(inputPipeName) {\n\t\t\tresult.request = this.request.bind(this, inputPipeName);\n\t\t}\n\t\tif(outputPipeName) {\n\t\t\tresult.render = this.render.bind(this, outputPipeName);\n\t\t}\n\t\tresult.wok = this;\n\t\treturn result;\n\t};\n\n\t/**\n\t * Registers a stage with the specified input and output pipes\n\t */\n\tWok.prototype.register = function(stage) {\n\t\tvar inputPipeName, outputPipeName;\n\t\tif('input' in stage) {\n\t\t\tinputPipeName = stage.input[0];\n\t\t\tthis.subscribe(inputPipeName, stage.input[1]);\n\t\t}\n\t\tif('output' in stage) {\n\t\t\toutputPipeName = stage.output[0];\n\t\t\tthis.provide(outputPipeName, stage.output[1]);\n\t\t}\n\t\treturn this._getStage(inputPipeName, outputPipeName);\n\t};\n\t\n\t/**\n\t * The most fundamental part of a Wok.js pipe is the provider,\n\t * the function that listens to request on a pipe (and hopefully responds with `wok.render`).\n\t * There is only one provider per pipe.\n\t * @param provider will be the function that is called whenever the configuration for this pipe changes and\n\t *                 indicates to the source that it should call `wok.render` with updated data.\n\t * @param replace If you want to call `wok.provide` multiple times for the same pipe in\n\t *                order to replace the previous provider, set the this to `true`.\n\t */\n\tWok.prototype.provide = function(pipeName, source, replace) {\n\t\tvar wok = this._getPipe(pipeName);\n\t\tif(wok.source && !replace) {\n\t\t\tthrow new Error('Cannot replace defined pipe “'+pipeName+'”’s source');\n\t\t}\n\t\twok.source = source;\n\t};\n\n\t/**\n\t * Use `wok.subscribe` to register a function that displays data.\n\t * Whenever a pipe gets rendered, the `subscriber` gets called with the updated data.\n\t * The idea is for the subscriber to either display the data or pass a modified version on to a different pipe.\n\t */\n\tWok.prototype.subscribe = function(pipeName, destination) {\n\t\tvar wok = this._getPipe(pipeName);\n\t\twok.destinations.push(destination);\n\t};\n\t\n\t/**\n\t * Renders a pipe by updating all its destinations\n\t */\n\tWok.prototype.render = function(pipeName, data) {\n\t\t// jshint unused: false\n\t\tvar wok = this._getPipe(pipeName);\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\tif(this.debug) {\n\t\t\tconsole.debug('Wok rendering '+pipeName+'', args, wok.destinations);\n\t\t}\n\t\tfor(var i=0;i<wok.destinations.length;i++) {\n\t\t\twok.destinations[i].apply(this, args);\n\t\t}\n\t};\n\n\t/**\n\t * Requests data from a pipe. Configuration options are passed along to the source\n\t */\n\tWok.prototype.request = function(pipeName, options) {\n\t\t// jshint unused: false\n\t\tvar wok = this._getPipe(pipeName);\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\tif(this.debug) {\n\t\t\tconsole.debug('Wok requesting '+pipeName+'', args, wok.source);\n\t\t}\n\t\treturn wok.source.apply(this, args);\n\t};\n\n\twindow.Wok = Wok;\n})(window.JSON);"],"sourceRoot":"/source/"}